image: alpine/edge
packages:
  - git
sources:
  - https://github.com/mellium/xmpp.git
tasks:
  - dco: |
      git version
      cd xmpp/
      function on_err {
        cat <<EOF
      Failed to sign the Developer Certificate of Origin (DCO)!
      Please read the file "DCO" and then, if you agree, sign each of your commits
      using:

          git commit -s

      Or quickly sign the previous commit with:

          git commit --amend -s --no-edit
      EOF
      }
      trap on_err ERR

      [[ "$(git log --no-merges --pretty='%(trailers:key=Signed-off-by,valueonly)' master..)" ]]
