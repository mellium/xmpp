image: golang:latest
pipelines:
  default:
    - step:
      script:
        - mkdir -p "$GOPATH/src/mellium.im/"
        - ln -s "`pwd`" "$GOPATH/src/mellium.im/xmpp"
        - cd "$GOPATH/src/mellium.im/xmpp"
        - GO15VENDOREXPERIMENT=1 go-wrapper download
        - make test
        - GO15VENDOREXPERIMENT=1 go test -cover -bench . -benchmem -run 'Benchmark.*' ./...
